## Название
Инструкция по использованию обработки "Корректировка назначений" (`MRS_КорректировкаНазначений`)

## Контекст и цели

### Проблема и предпосылки
В системе могут накапливаться остатки по товарам, у которых заполнено измерение "Назначение". Такие остатки могут возникать из-за особенностей учета или ошибок и требовать специальной процедуры для корректного списания. Данная обработка предназначена для автоматизации процесса анализа и списания таких товарных остатков.

### Цели
*   Предоставить пользователю инструмент для анализа остатков товаров с непустыми назначениями на определенную дату.
*   Автоматизировать создание документа для списания всех выявленных остатков с назначениями.
*   Обеспечить контроль за возникновением отрицательных остатков после выполнения корректировки.

### Вне рамок / Ограничения
*   Обработка не позволяет выполнять выборочное списание остатков. Списываются **все** остатки с непустым назначением.
*   Обработка не анализирует причины возникновения таких остатков.
*   Обработка создает только один тип документа — `Корректировка регистров`.

## Основные функции
1.  **Формирование отчета**: Вывод в табличный документ перечня остатков по товарам, имеющим непустое "Назначение" в регистрах накопления.
2.  **Выполнение корректировки**: Автоматическое создание и проведение документа `Корректировка регистров`, который списывает (делает движение "Расход") все найденные остатки с назначениями.

## Порядок работы (Flows)

### Шаг 1: Запуск и настройка
1.  Откройте обработку `MRS_КорректировкаНазначений`.
2.  На форме вы увидите следующие поля:
    *   **Дата**: Укажите дату, на которую необходимо проанализировать остатки и выполнить списание. Если оставить поле пустым, будет использована текущая дата сеанса.
    *   **Комментарий**: Текст, который будет указан в комментарии создаваемого документа `Корректировка регистров`. Если оставить пустым, будет использован текст по умолчанию: "ERP-5399. Корректировка назначений.".

### Шаг 2: Анализ остатков (Формирование отчета)
1.  Убедитесь, что поле **Дата** заполнено корректно.
2.  Нажмите кнопку **"Сформировать отчет"**.
3.  В нижней части формы, в табличном документе **Результат**, будет выведен отчет, содержащий все остатки товаров с непустыми назначениями на указанную дату.
4.  Проанализируйте данные отчета перед выполнением корректировки.

### Шаг 3: Выполнение корректировки
**Внимание!** Следующий шаг создаст документ, который спишет **все** найденные остатки. Эта операция может существенно повлиять на данные учета. Убедитесь, что вы понимаете последствия.

1.  Заполните поля **Дата** и **Комментарий** (при необходимости).
2.  Нажмите кнопку **"Выполнить"**.
3.  Обработка выполнит следующие действия:
    *   Найдены все остатки с непустыми назначениями в регистрах `СебестоимостьТоваров`, `ТоварыОрганизаций`, `ТоварыНаСкладах`.
    *   Будет создан и проведен новый документ `Корректировка регистров` на указанную **Дату**.
    *   Этот документ создаст движения с видом "Расход" по всем найденным остаткам.
4.  После выполнения в поле **Документ корректировки** появится ссылка на созданный документ.

### Шаг 4: Проверка результата
1.  Откройте созданный документ `Корректировка регистров`, перейдя по ссылке в поле **Документ корректировки**. Убедитесь, что он создан корректно.
2.  После выполнения корректировки обработка автоматически запускает проверку на наличие отрицательных остатков.
3.  Если будут обнаружены отрицательные остатки в затронутых регистрах, на экран будут выведены служебные сообщения с перечнем проблемных позиций (Номенклатура, Склад, Остаток). В этом случае требуется дополнительный анализ данных учета.

## Данные и интеграции

### Основные сущности
Обработка взаимодействует со следующими объектами системы:

*   **Регистры накопления (для чтения остатков и записи движений):**
    *   `СебестоимостьТоваров`
    *   `ТоварыОрганизаций`
    *   `ТоварыНаСкладах`
*   **Справочники (для фильтрации):**
    *   `Назначения`
*   **Документы (для создания):**
    *   `КорректировкаРегистров`

## Метаданные 1С

| Тип объекта              | Имя объекта                  | Действие                                 |
| ------------------------ | ---------------------------- | ---------------------------------------- |
| Обработка                | `MRS_КорректировкаНазначений` | Основной объект, реализующий логику      |
| Документ                 | `КорректировкаРегистров`       | Создается для списания остатков          |
| Регистр накопления       | `СебестоимостьТоваров`       | Источник данных и объект для записи      |
| Регистр накопления       | `ТоварыОрганизаций`          | Источник данных и объект для записи      |
| Регистр накопления       | `ТоварыНаСкладах`            | Источник данных и объект для записи      |
| Справочник               | `Назначения`                 | Используется в условии отбора остатков   |
